# DeployMaster Pro 企业级自动化部署客户端 - 需求规格说明书 (PRD)

| 项目名称 | DeployMaster Pro | 版本 | v1.2.0 |
| :--- | :--- | :--- | :--- |
| **项目类型** | 跨平台桌面客户端 (Windows/Linux) | **状态** | 开发中/原型已锁定 |
| **主要目标** | 实现从SVN源码库到多节点服务器的自动化分发、同步及指令编排 | **核心价值** | 提升传输速度、标准化部署流程、实时监控执行过程 |

## 1. 产品背景与目标

在复杂的企业级运维环境中，系统安装包通常存储在 **SVN** 服务器上。手动下载、上传至多台服务器、解压并执行初始化脚本的过程不仅效率低下，且极易出错。**DeployMaster Pro** 旨在通过“主从同步模型”和“任务编排引擎”，实现一键式、可视化的自动化部署。

## 2. 核心功能模块

### 2.1 SVN 资源管理
- **多格式支持**：支持从 SVN 下载 `.zip`, `.tar.gz`, `.war`, `.jar` 等各类安装包，支持目录检出。
- **版本管理**：实时同步 SVN 修订号 (Revision)，支持锁定特定版本或使用 HEAD 最新版。
- **连接测试**：内置 SVN 鉴权机制（用户名/密码），支持一键连通性测试。

### 2.2 节点拓扑管理
- **主从架构 (Master-Slave)**：
  - **Master (主控机)**：作为中转站，接收从 SVN 检出的文件。
  - **Slave (从机)**：通过 P2P 或内网高速协议接收来自 Master 的同步数据。
- **多协议支持**：支持配置远端 IP、端口，支持 SFTP、SCP、FTP 等多种传输协议。
- **状态监控**：实时心跳检测，显示各节点的响应延迟 (Latency)。

### 2.3 任务分发编排
- **流水线设计**：定义完整的部署工作流：`下载(SVN)` -> `上传(Master)` -> `同步(Slaves)` -> `执行(Commands)`。
- **参数详情**：支持查看工作流的静态配置，包括关联资源、目标路径、拓扑节点。
- **同步加速**：Master 获取文件后，自动并行分发至所有勾选的 Slave 节点，显著提升跨机房/跨子网传输速度。

### 2.4 自动化指令执行
- **自定义脚本**：支持在远程服务器上执行多行自定义 Shell 脚本（如：`unzip`, `chmod`, `systemctl restart`）。
- **串行执行逻辑**：脚本按序执行，任一步骤失败（返回非零状态码）均可触发任务中断并报警。

### 2.5 实时监控与日志
- **全局进度条**：可视化展示任务在“下载、上传、同步、执行”各阶段的百分比。
- **流式日志**：通过终端模拟器实时输出远程服务器的执行过程，支持不同级别的日志颜色高亮（INFO/SUCCESS/ERROR）。

## 3. 界面交互设计规格

### 3.1 页面布局
- **侧边导航栏 (Sidebar)**：深色主题，包含运行概览、SVN库、节点拓扑、任务编排、实时日志。
- **全局状态栏 (Header)**：显示当前页面标题及**“新建部署”全局快捷键**。
- **底部工具栏**：展示环境状态、主控机负载及系统通信状态。

### 3.2 关键交互场景
- **新建部署流**：
  1. 点击“新建部署”后，系统自动定位至编排页面并弹出模态框。
  2. 左侧配置基础参数（名称、资源、路径、主从节点），右侧使用 VSCode 风格编辑器编写脚本。
- **立即执行**：
  - 触发后，任务卡片状态由 `IDLE` 变为动态加载状态，进度条随实际执行阶段平滑推进。
- **详情审计**：
  - 点击详情图标，从右侧滑出高保真面板，审计该工作流的所有拓扑流向和脚本内容。

## 4. 技术要求与非功能性需求

### 4.1 技术栈推荐
- **框架**：React + TypeScript
- **样式**：Tailwind CSS (响应式、高保真 UI)
- **图标**：FontAwesome 6.x
- **跨平台方案**：Electron (建议用于封装为桌面应用)

### 4.2 性能与安全
- **传输优化**：大文件上传需支持断点续传（逻辑层），同步阶段需利用内网带宽。
- **安全性**：
  - 所有敏感凭据（SVN/SSH 密码）需本地加密存储。
  - 执行自定义指令前需经过安全声明，防止危险命令误操作。
- **响应式**：客户端需适配 1280px 至 1920px 宽度的各种显示器。

### 4.3 异常处理
- **SVN 故障**：检出失败时，应在日志中明确输出 SVN 错误码并停止后续上传。
- **同步冲突**：当 Slave 节点目标路径已存在文件时，支持覆盖或备份逻辑配置。

## 5. 项目路线图 (Roadmap)

- **Phase 1 (已完成)**：UI 高保真原型设计、基础路由跳转、静态数据模型定义。
- **Phase 2 (当前阶段)**：完善任务编排参数详情、自动化流逻辑联动、模拟执行状态机。
- **Phase 3 (计划中)**：集成真正的 SVN/SSH 底层调用驱动、增加历史任务搜索及统计报表、导出执行报告。
